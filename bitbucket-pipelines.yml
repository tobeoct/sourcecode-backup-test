pipelines:
  branches:
    master:
      - step:
          name: Mirror Repository Changes to GitHub
          image: alpine/git:latest
          clone:
            enabled: false
          script:
            - echo "Running Script"
            - echo "New tag $BITBUCKET_TAG"
            - if [ "$BITBUCKET_TAG" ]; then
                - echo "Triggered on tag creation"
                - git clone --bare --branch master git@bitbucket.org:appzonegroup/sourcecode-backup-test.git
                - cd sourcecode-backup-test.git
                - git push --mirror git@github.com:tobeoct/heritage-middleware.git
                - echo "Mirroring Completed"
            - fi;
  tags:
    '*':
      - step:
          name: Mirror to GitHub
          image: alpine/git
          script:
            - echo "Running Script"
            - echo "New tag $BITBUCKET_TAG"
            - if git rev-list -n 1 --branches=master --tags --grep '^$BITBUCKET_TAG$' >/dev/null; then
              - echo "Triggered on tag creation"
              - git clone --bare --branch master git@bitbucket.org:appzonegroup/sourcecode-backup-test.git
              - cd sourcecode-backup-test.git
              - git push --mirror git@github.com:tobeoct/heritage-middleware.git
              - echo "Mirroring Completed"
            - fi;